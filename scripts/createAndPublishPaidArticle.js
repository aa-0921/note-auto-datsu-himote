// createAndPublishPaidArticle.js
// 薄いラッパー：既存のCLI引数・動作は維持しつつ、実装は共有ライブラリに委譲

import { runWithCore } from '@aa-0921/note-auto-core';

(async () => {
  await runWithCore(async ({ core, wantsBackground }) => {
    // このスクリプトだけ異なるAIモデルを使用する（長文生成に適したモデル）
    core.aiGenerator.models.article = 'tngtech/deepseek-r1t2-chimera:free';
    core.aiGenerator.models.rewrite = 'tngtech/deepseek-r1t2-chimera:free';
    core.aiGenerator.models.tags = 'tngtech/deepseek-r1t2-chimera:free';
    console.log('使用するAIモデル:', core.aiGenerator.models);

    // アカウント固有の題材・切り口（非モテ男子の恋愛研究所）
    const topics = [
      '低身長男子の恋愛戦略',
      '低身長だからこその魅力アピール術',
      '低身長男子の初回デート攻略法',
      '低身長女性が求める男性像',
      '低身長女性とのデート術',
      '低身長女性の本音の見抜き方',
      '低身長女性との会話術',
      '低身長女性との関係発展法',
      '自信のない男の改善法',
      '脈ありサインの見抜き方',
      'フレンドゾーン脱出法',
      '告白のタイミング',
      'アプローチの仕方',
      '姿勢・仕草の改善',
      'モテる男の特徴',
      '非モテから脱却する方法',
      '職場恋愛のコツ',
      '年上女性との恋愛',
      '年下女性との恋愛',
      '同年代女性との恋愛',
      '恋愛での失敗パターン',
      '恋愛での成長方法',
      '初回デートの会話術',
      'デート後のフォロー術',
      '女性の本音の見抜き方',
      '恋愛での距離感の取り方',
      '女性に好かれる話し方',
      '女性の気持ちを理解する方法',
      '恋愛での失敗を活かす方法',
      '女性との共通点の見つけ方',
      '恋愛での緊張を和らげる方法',
      '女性にアピールする方法',
      '恋愛でのコミュニケーション術',
      '女性の興味を引く話題',
      'タイミングの見極め方',
      '女性との関係を深める方法',
      // 追加：クリックしたくなるキーワード
      '身長が低くてもモテる男の共通点',
      '女性が「この人いい」と思う瞬間',
      '既読スルーされた時の挽回術',
      'LINEで距離が縮まる返し方',
      '好意が伝わる褒め方・褒められ方',
      '断られない誘い方の鉄則',
      '友達以上恋人未満から抜け出す一言',
      '女性が心を開く質問の仕方',
      'デート中に手をつなぐタイミング',
      'キスに発展させる流れの作り方',
      '彼女ができる人とできない人の決定的な差',
      '女性に「頼りになる」と思わせる話し方',
      'マッチングアプリで会うまでにやること',
      '初デートで好印象を残す服装・持ち物',
      '女性が「また会いたい」と思う別れ方',
      '浮気されない関係の築き方',
      '長く愛される男友達との違い',
      'モテない原因を自己分析する方法',
      '女性心理がわかる本音サイン集',
      '告白前にやるべき確認事項',
      '振られた後の立ち直りと次の一手',
    ];

    const patterns = [
      '【低身長×おとなしい女性を落とす】静かな女性との身長差活用法',
      '【低身長女性】',
      '【低身長女性を落とす】恋愛に発展させる方法',
      '【低身長女性を落とす】低身長女性が求めている男性像',
      '【低身長女性を落とす】低身長女性に好かれる方法',
      '【無意識にやってる？】NG行動',
      '【ただの友達で終わらない】発展術',
      '【もう勘違いしない】見抜き方',
      '【24時間以内にデート確定】即誘い術',
      '【人生逆転】ギャップ演出術',
      '【9割の男が知らない】戦略',
      '【彼女を作る】成功率を上げる方法',
      '【好かれる話し方】コミュニケーション術',
      // 追加：思わずクリックしたくなる見出しパターン
      '【低身長でも余裕】女性に選ばれる男の条件',
      '【今すぐやめろ】女性が引く男の口癖5選',
      '【彼女0人→できた】実体験で語る転機',
      '【女性が本気で落ちる】たった一つの習慣',
      '【友達のまま終わる人】共通する特徴',
      '【既読無視されない】LINEで好かれる鉄則',
      '【脈ありかどうか】3秒でわかる見分け方',
      '【デート誘いOK率UP】断られない言い方',
      '【身長より大事】女性が重視していること',
      '【勘違いしない】本気のサインの見極め方',
      '【1回のデートで】関係を一気に縮める方法',
      '【非モテ脱出】まず変えるべき3つのこと',
      '【告白の成功率】タイミングと伝え方',
      '【女性が惚れる】声のトーンと話し方',
      '【マッチングアプリ】会う前にやっておくこと',
      '【彼女ができる人】共通する思考パターン',
      '【振られても大丈夫】次の恋に活かす考え方',
      '【女性の本音】実はこう思ってる瞬間',
      '【低身長男子あるある】逆に武器にする方法',
      '【好かれる男】無意識にやってる小さな気遣い',
    ];

    const rewriteConditionsLines = [
      'あなたは元非モテ男子の恋愛アドバイザーです。',
      '指定の見出し本文が短いため、300文字以上になるよう実体験や具体例、アドバイスを交えて厚くリライトしてください。',
      '【注意】',
      '- タイトルや見出しは出力せず、本文のみを返す。',
      '- メタ情報（追加要素や文字数など）は一切出力しない。',
      '- 丁寧な敬語（です・ます）で、読みやすさ重視。',
      '- 絵文字は使わない。',
      '- 元の内容に沿い、noteのMarkdownのみ使用。',
      '- 箇条書きは「・ 」、番号付きリストは使わない。',
      '- 元非モテ男子として、同じ悩みを持つ男性に寄り添い、具体的で実践的なアドバイスを提供する。',
      '- 「〇〇の〇〇です」という名乗りは避ける。',
    ];

    // 有料セクション拡充用のリライト条件（各セクションを2500文字以上に拡充）
    const paidSectionRewriteConditions = [
      'あなたは元非モテ男子の恋愛アドバイザーです。',
      '指定の見出し本文を、最低2500文字以上になるよう詳細にリライトしてください。',
      '科学的根拠、具体例、実体験、ステップバイステップの手順を豊富に含めてください。',
      '【注意】',
      '- タイトルや見出しは出力せず、本文のみを返す。',
      '- 【最重要】メタ情報（追加要素や文字数など）は一切出力しない。',
      '- 【最重要】本文中に「（○文字）」「（○,○○○文字）」「文字数」などの文字数表示を絶対に含めないでください。',
      '- 【最重要】記事の最後に文字数を表示しないでください。',
      '- 丁寧な敬語（です・ます）で、読みやすさ重視。',
      '- 絵文字は使わない。',
      '- 元の内容に沿い、noteのMarkdownのみ使用。',
      '- 箇条書きは「・ 」、番号付きリストは使わない。',
      '- 元非モテ男子として、同じ悩みを持つ男性に寄り添い、具体的で実践的なアドバイスを提供する。',
      '- 「〇〇の〇〇です」という名乗りは避ける。',
      '- 最低2500文字以上になるように必ず最後まで完全に生成すること。',
      '- 記事が途中で終わってはいけません。',
      '- 各セクションには以下を含めて文字数を増やしてください：',
      '  - 科学的根拠の詳細な説明（500文字以上）',
      '  - 具体的な実体験や事例（500文字以上）',
      '  - ステップバイステップの詳細な手順（500文字以上）',
      '  - よくある失敗例とその対処法（300文字以上）',
      '  - より効果を高めるコツや応用方法（200文字以上）',
    ];

    // LLM用システムプロンプト（非モテ男子の恋愛研究所）
    const systemMessage =
      'あなたは元非モテ男子で、心理学・行動科学の研究に基づいた科学的な根拠を持つ恋愛アドバイザーです。同じ悩みを持つ男性に寄り添い、科学的に立証された実践的なアドバイスを提供します。' +
      '【最重要】記事は必ず「## 有料セクション」の見出しを含め、その後に最低10000文字以上の詳細な内容を最後まで完全に生成してください。途中で生成を止めてはいけません。' +
      '【最重要】「## 有料セクション」の内容は、5つのセクションそれぞれを2000文字以上で詳細に記述し、合計10000文字以上になるようにしてください。' +
      '【最重要】トークン制限に達する前に必ず記事を完成させてください。「最後までお読みいただきありがとうございます」という終了文言まで必ず生成してください。';

    // 有料セクション拡充用のシステムプロンプト（各セクションを2500文字以上に拡充する際に使用）
    const paidSectionSystemMessage =
      'あなたは元非モテ男子で、心理学・行動科学の研究に基づいた科学的な根拠を持つ恋愛アドバイザーです。同じ悩みを持つ男性に寄り添い、科学的に立証された実践的なアドバイスを提供します。' +
      '【最重要】指定された見出しの本文を、最低2500文字以上になるよう詳細にリライトしてください。' +
      '【最重要】科学的根拠、具体例、実体験、ステップバイステップの手順を豊富に含めてください。' +
      '【最重要】途中で生成を止めず、最後まで完全に生成してください。';

    // 記事生成プロンプト条件（非モテ男子の恋愛研究所）
    const articleConditionsLines = [
      'タイトル、本文、ハッシュタグ（#から始まるもの）を含めてください。',
      'タイトルは1行目に「# [実際のタイトル] | 彼女 | モテる | 女性 | 恋愛 | デート」として記載してください。',
      '「# タイトル」という文字列ではなく、実際の記事タイトルを入れてください。',
      '本文にはタイトルを含めないでください。',
      '本文は見出しや箇条書きも交えて1000文字程度で丁寧にまとめてください。',
      '【最重要】「## 有料セクション」の内容は最低10000文字以上で詳細に記述してください。',
      '【最重要】5つのセクションそれぞれを2000文字以上で記述し、合計10000文字以上になるようにしてください。',
      'ハッシュタグは記事末尾に「#〇〇 #〇〇 ...」の形式でまとめてください。',
      '【重要】記事には必ずタグを設定して',
      'あなたは元非モテ男子で、プロの編集者です。',
      '読みやすさを重視してください。',
      '改行を多めに入れてください。',
      '絵文字は使わないでください。',
      'すべて日本語で出力してください。',
      'noteの正しいマークダウン記法のみを使ってください。',
      '箇条書きはマークダウンではなく、「・ 」で表現してください。',
      '見出しはh2（## 見出し）・h3（### 見出し）のみ。',
      '見出しに「**」等は使わないでください。',
      '番号付きリストは使わないでください。',
      'h1（# タイトル）はタイトル行のみで本文中では使わないでください。',
      'その他のマークダウンやHTMLタグは使わないでください。',
      '元非モテ男子として、同じ悩みを持つ男性に共感し、具体的で実践的な解決策を提供してください。',
      '恋愛でうまくいかない男性の現状を理解し、希望を与える内容にしてください。',
      '「〇〇の〇〇です」という名乗りは避けてください。',
      '・タイトルや本文に「無料」「有料」という言葉は絶対に使用しないでください。',
      '・【重要】必ず5つの項目を提示し、有料部分も5つの章で構成すること（4つや6つは禁止）',
      '',
      '【記事の構成と流れ】',
      '以下の構成に従って記事を作成してください：',
      '',
      '1. タイトル：',
      '・年号を入れる場合は必ず「2025年」を使用し、「2024年」は使わない',
      '・年号は必須ではなく、必要に応じて使用する',
      '・感情に訴える表現（「劇的に」「急に」「瞬時に」など）',
      '・数字の効果的な使用（年号、割合、時間制限など）',
      '・タイトルに「無料」「有料」という言葉は絶対に使用しない',
      '',
      '2. 導入部分：',
      '・現状の問題提起：読者の悩みに共感する現状描写',
      '・共感の誘発：「〜したことはありませんか？」という問いかけ',
      '・科学的根拠の提示：心理学・行動科学の研究データや統計を引用',
      '・解決策の提示：問題の正体を明示し、科学的な解決の可能性を示す',
      '・本文に「無料」「有料」という言葉は絶対に使用しない',
      '',
      '3. 無料部分の充実化：',
      '・無料部分では具体的なヒントや解決策は提供しない',
      '・現状できていないことでの問題点やリスク、デメリットを強調',
      '・「このまま彼女ができないよりは読んだほうが絶対にいいです」という緊迫感を演出',
      '・有料部分で得られる「完全版」の価値をアピールし、期待感を高める',
      '',
      '4. 無料部分の追加コンテンツ：',
      '・5つの価値提示の後に、問題点やリスクの詳細説明を追加',
      '・各ポイントについて、現状のままだとどうなるかのデメリットを強調',
      '・「このまま彼女ができないよりは読んだほうが絶対にいいです」という緊迫感を強調',
      '・有料部分で得られる価値をアピール',
      '・読者の現状への不安を煽り、行動を促す',
      '・具体的な解決策は一切提供せず、問題の深刻さのみを伝える',
      '',
      '5. 有料項目紹介セクション（必須）：',
      '・【重要】必ず「この記事を読むことで、あなたは以下の5つを知ることができます。」の文言を使用',
      '・【重要】必ず①、②、③、④、⑤の5つの記号で5つの価値を提示（4つや6つは禁止）',
      '・【重要】5つの項目は必ず存在し、有料部分の5つの章と完全に一致すること',
      '・各ポイントは簡潔で魅力的なタイトルにする',
      '・読者の期待感を最大限に高める',
      '・「このまま彼女ができないよりは読んだほうが絶対にいいです」という緊迫感を強調',
      '・有料部分で得られる価値をアピール',
      '・読者の現状への不安を煽り、行動を促す',
      '・具体的な解決策は一切提供せず、問題の深刻さのみを伝える',
      '・有料部分のボリュームはかなりのものでお得であることを伝える',
      '',
      '6. 有料部分メッセージ：',
      '・「有料項目紹介セクション」の直後に「ここからは有料になります」と明記',
      '・「----------------------------------------」と線を表示',
      '',
      '7. 有料部分の見出し（必須）：',
      '・【重要】「----------------------------------------」の直後に、必ず「## 有料部分の内容について」という見出しを1つ含めること',
      '・【重要】その後に、必ず「## 有料セクション」という見出しを1つ含めること',
      '・【重要】この2つの見出しは必須であり、省略してはいけません',
      '',
      '8. 有料部分の構成（必須）：',
      '・【重要】「## 有料セクション」の見出しの後に、必ず5つのセクションを作成（4つや6つは禁止）',
      '・【最重要】各セクションは最低2000文字以上で具体的な方法を詳細に解説してください（文字量を大幅に増やす）',
      '・【最重要】「## 有料セクション」全体で合計最低10000文字以上の詳細な内容を必ず書いてください。',
      '・【最重要】各セクションには以下を含めて文字数を増やしてください：',
      '  - 科学的根拠の詳細な説明（500文字以上）',
      '  - 具体的な実体験や事例（500文字以上）',
      '  - ステップバイステップの詳細な手順（500文字以上）',
      '  - よくある失敗例とその対処法（300文字以上）',
      '  - より効果を高めるコツや応用方法（200文字以上）',
      '・【最重要】記事が途中で終わってはいけません。「## 有料セクション」の内容を最後まで完全に生成してください。',
      '・【重要】無料部分で約束した5つの価値と有料部分の内容が完全に一致すること',
      '・【重要】有料部分のタイトルは、無料部分の「有料項目紹介セクション」で提示した5つのタイトルをそのまま使用すること',
      '・【重要】有料部分の各セクションのタイトルは「## タイトル」の形式で記述すること',
      '・【重要】記事の構成順序：',
      '  1. 「ここからは有料になります」',
      '  2. 「----------------------------------------」',
      '  3. 「## 有料部分の内容について」（必須）',
      '  4. 「## 有料セクション」（必須）',
      '  5. 5つの具体的なセクション（## タイトル形式）',
      '・【重要】各セクションに科学的根拠を必ず含めること：',
      '  - 心理学の法則や理論（例：互恵性の法則、ツァイガルニク効果、社会的承認の原理など）',
      '  - 行動科学の研究結果（例：脳科学、神経科学の知見）',
      '  - 科学的なメカニズムの説明',
      '  - 実践的で即効性のある内容',
      '  - 具体的な実体験や事例を豊富に含めること',
      '  - ステップバイステップの詳細な手順を説明すること',
      '  - 読者が実際に行動できる具体的なアドバイスを提供すること',
      '',
      '【記事の終わり方】',
      '・記事の最後は以下の文言で終わること：',
      '「最後までお読みいただきありがとうございます！💬」',
      '「継続して、有益な情報を発信していきますので、スキ・フォローお願いします！」',
      '・【最重要】記事は必ず最後まで完全に生成してください。途中で止めてはいけません。',
      '・【最重要】「## 有料セクション」の5つのセクションすべてを完全に記述し、終了文言まで必ず生成してください。',
    ];

    const tagsInstruction = '記事内容から最も関連する日本語タグを3〜5個生成し、半角スペース区切りで出力してください。必ず「#非モテ #恋愛 #彼女 #マッチングアプリ #攻略 #心理学 #科学的根拠」を含めてください。本文や説明は禁止。';

    const titleEmojis = ['💕','💘','😍','💪','🔥','✨','💎','🎯','🚀','💯','👑','💖'];
    
    const priceOptions = [390, 490, 590];
    const price = priceOptions[Math.floor(Math.random() * priceOptions.length)];
    console.log(`選択された価格: ${price}円`);


    // 有料記事として作成＆直接投稿
    await core.runCreateAndPublishPaidArticle({
      background: wantsBackground,
      topics,
      patterns,
      systemMessage,
      articleConditionsLines,
      rewriteConditionsLines,
      tagsInstruction,
      titleEmojis,
      // マガジン誘導文（有料記事では不要）
      magazinePromotion: [],
      // 有料設定
      paidEnabled: true,
      price: price, // 価格（円）
      // サムネイル（必要に応じてリポジトリ側の既定を使用）
      // thumbnailDir: 'thumbnails',
      // アフィリエイトは有料記事ではコア側で無効化されます
      // 文字量を増やすための設定
      maxTokens: 32000, // 長い記事を生成するため（10000文字以上を確保）
      paidMode: true, // 有料記事モードを有効化
      paidRewriteHeading: '有料部分の内容について', // このセクションのみリライト
      // 有料セクション拡充用のリライト設定
      paidSectionRewriteConditions: paidSectionRewriteConditions, // 有料セクションが短い場合の拡充用プロンプト
      paidSectionSystemMessage: paidSectionSystemMessage, // 有料セクション拡充時のsystemMessage
      paidSectionRewriteMaxTokens: 8000, // 各セクション2500文字を生成するためのmaxTokens
    });

    console.log('有料記事の自動生成と投稿が完了しました');
  });
})();


